<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  <mapper namespace="com.web.www.repository.MemberDAO">
  <!-- 멤버등록 -->
	<insert id="insertMember">
		insert into member(member_id, member_pwd, 
		member_alias, member_name, member_email,
		member_address, member_address_detail,
		member_phone_num, member_terms1, member_terms2, member_terms3)
			
		values(#{memberId}, #{memberPwd}, #{memberAlias}, #{memberName}, #{memberEmail},
	  	#{memberAddress}, #{memberAddressDetail}, #{memberPhoneNum}, 
	  	#{memberTerms1},#{memberTerms2},#{memberTerms3})
	</insert>
	
	<select id="getUser" resultType="com.web.www.domain.member.MemberVO">
		select * from member where member_id = #{memberId} and member_type = #{memberType}
	</select>
	
	<!-- 멤버수정 -->
	<update id="socialModifyMember">
		update member set member_alias = #{memberAlias}, member_email = #{memberEmail}, 
		member_phone_num = #{memberPhoneNum}, member_address = #{memberAddress}, member_address_detail = #{memberAddressDetail}
		where member_id = #{memberId} and member_type = #{memberType}
	</update>
	
	<update id="normalModifyMember">
		update member set member_alias = #{memberAlias},
		member_phone_num = #{memberPhoneNum}, member_address = #{memberAddress}, member_address_detail = #{memberAddressDetail}
		where member_email = #{memberEmail} and member_type = #{memberType}
	</update>
	
	<!-- 비밀번호 수정 -->
	<update id="updatePwd">
		update member set member_pwd = #{changePwd} where member_num = #{memberNum}
	</update>
	
	
	
	<select id="checkId" resultType="int">
		select count(member_id) from member where member_id = #{memberId}
	</select>
	
	<select id="checkEmail" resultType="int">
		select count(member_email) from member where member_email = #{memberEmail} and member_type = 'normal'
	</select>
	
	<!-- 시큐리티 userDetail클래스 DB 선접근 mapper -->
	<select id="selectMemberId" resultType="com.web.www.domain.member.MemberVO">
		select * from member where member_id = #{memberId}
	</select>
	
	<select id="selectAuths" resultType="com.web.www.security.AuthVO">
		select * from auth_member where member_id = #{memberId}
	</select>
	
	<!-- 시큐리티 LastLogin 날짜 갱신 -->
	<update id="updateLastLogin">
		update member set member_last_at = now() where member_id = #{memberId}
	</update>
	
	<!-- 시큐리티 권한부여 -->
	<insert id="insertAuthInit">
		insert into auth_member(member_id, auth)
		values(#{memberId}, 'ROLE_USER')
	</insert>

	<!-- 시큐리티 Oauth 유저(소셜) 선접근 -->
	<select id="socialSearch" resultType="com.web.www.domain.member.MemberVO">
		select * from member where member_id = #{memberId}
	</select>
	<!-- 시큐리티 Oauth 유저(소셜) 가입 -->
	<insert id="socialRegister">
		insert into member(member_id, member_pwd,
		member_alias, member_name, member_email,
		member_phone_num, member_type)
			
		values(#{memberId}, #{memberPwd}, #{memberAlias}, #{memberName}, #{memberEmail},
	  	#{memberPhoneNum}, #{memberType})
	</insert>
	
	<update id="cdCheck">
		update member set member_terms3 = #{memberTerms3} where member_id = #{memberId}
	</update>
	
	<!-- 쿠폰관련 -->
	<select id="couponCheck" resultType="int">
		select count(*) from coupon_system
	</select>
	<insert id="couponCreate">
		insert into coupon_system(coupon_day, coupon_name, coupon_type, coupon_int, coupon_rate)
		value(#{couponDay}, #{couponName}, #{couponType}, #{couponInt}, #{couponRate})
	</insert>

  </mapper>